/**
 * emv-router.js 1.0.0
 *
 * @author Elvyrra S.A.S
 * @license http://rem.mit-license.org/ MIT
 */
"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module){var r=require("emv");module.exports=e(r)}else"function"==typeof define&&define.amd?define(["emv"],e):e(t.EMV)}(void 0,function(t){var e=function(){function t(e){var r=this;_classCallCheck(this,t),Object.keys(e).forEach(function(t){r[t]=e[t]}),this.args=[],this.pattern=this.path.replace(/\{(\w+?)\}/g,function(t,e){return r.args.push(e),"(.*?)"})}return _createClass(t,[{key:"getPath",value:function(t){var e=this.path;return t&&Object.keys(t).forEach(function(r){e=e.replace("{"+r+"}",t[r])}),e}},{key:"match",value:function(t){var e=new RegExp("^"+this.pattern+"$");return t.match(e)}},{key:"getData",value:function(t){var e=new RegExp("^"+this.pattern+"$"),r=e.exec(t),n={};return null===r?null:(this.args.forEach(function(t,e){n[t]=r[e+1]}),n)}}]),t}(),r=function(r){function n(){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,{data:{path:"",route:null},computed:{template:function(){return this.route?this.route.template||this.route.templateUrl:""},model:function(){return this.route?this.route.model:null}}}));return t.$watch("model",function(e){t.route&&t.route.init&&e[t.route.init]&&t.model[t.route.init].call(e)}),t}return _inherits(n,r),_createClass(n,[{key:"getPath",value:function(t,e){var r=this.getRoute(t);return r?r.getPath(e):"/"}},{key:"getRoute",value:function(t){return this.routes[t]||null}},{key:"getRouteNameByPath",value:function(t){var e=this;return Object.keys(this.routes).find(function(r){return e.routes[r].match(t)})}},{key:"getRouteByPath",value:function(t){var e=this.getRouteNameByPath(t);return e&&this.routes[e]||null}},{key:"render",value:function(t,e){var r=this;this.path=location.hash.substr(1);var n=this.getRouteByPath(this.path);if(!n)return void(this.route=n);if(n.templateUrl&&!e.$templates[n.templateUrl]){var o=new XMLHttpRequest;o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&(e.$registerTemplate(n.templateUrl,o.responseText),r.route=n)},o.open("GET",n.templateUrl,!0),o.send(null)}else this.route=n}},{key:"init",value:function(r,n,o){var i=this;this.routes={},Object.keys(t.config.routes).forEach(function(r){i.routes[r]=new e(t.config.routes[r])}),o.$observe("$router",this),o.$setElementDirective(r,"with","$router.model"),t.directives.with.init.call(this,r,"$router.model",this),o.$setElementDirective(r,"template","$parent.template"),location.hash||(location.hash="#/"),this.render(r,o)}},{key:"bind",value:function(t,e,r){var n=this;window.onhashchange=function(){n.model&&Array.from(t.childNodes).forEach(function(t){n.model.$clean(t)}),n.render(t,r)}}}]),n}(t);t.$router=new r,t.directive("router",t.$router),t.transform("path",function(e,r){return"#"+t.$router.getPath(e,r)})});