/**
 * emv-router.js 1.0.0
 *
 * @author Elvyrra S.A.S
 * @license http://rem.mit-license.org/ MIT
 */
"use strict";!function(t,e){if("object"==typeof exports&&"undefined"!=typeof module){const t=require("emv");module.exports=e(t)}else"function"==typeof define&&define.amd?define(["emv"],e):e(t.EMV)}(this,function(t){class e{constructor(t){Object.keys(t).forEach(e=>{this[e]=t[e]}),this.args=[],this.pattern=this.path.replace(/\{(\w+?)\}/g,(t,e)=>{return this.args.push(e),"(.*?)"})}getPath(t){let e=this.path;return t&&Object.keys(t).forEach(n=>{e=e.replace(`{${n}}`,t[n])}),e}match(t){const e=new RegExp(`^${this.pattern}$`);return t.match(e)}getData(t){const e=new RegExp(`^${this.pattern}$`),n=e.exec(t),i={};return null===n?null:(this.args.forEach((t,e)=>{i[t]=n[e+1]}),i)}}class n extends t{constructor(){super({data:{path:"",route:null},computed:{template:function(){return this.route?this.route.template||this.route.templateUrl:""},model:function(){return this.route?this.route.model:null}}}),this.$watch("model",t=>{this.route&&this.route.init&&t[this.route.init]&&this.model[this.route.init].call(t)})}getPath(t,e){const n=this.getRoute(t);return n?n.getPath(e):"/"}getRoute(t){return this.routes[t]||null}getRouteNameByPath(t){return Object.keys(this.routes).find(e=>{return this.routes[e].match(t)})}getRouteByPath(t){const e=this.getRouteNameByPath(t);return e&&this.routes[e]||null}render(t,e){this.path=location.hash.substr(1);const n=this.getRouteByPath(this.path);if(!n)return void(this.route=n);if(n.templateUrl&&!e.$templates[n.templateUrl]){const t=new XMLHttpRequest;t.onreadystatechange=(()=>{t.readyState===XMLHttpRequest.DONE&&(e.$registerTemplate(n.templateUrl,t.responseText),this.route=n)}),t.open("GET",n.templateUrl,!0),t.send(null)}else this.route=n}init(n,i,o){this.routes={},Object.keys(t.config.routes).forEach(n=>{this.routes[n]=new e(t.config.routes[n])}),o.$observe("$router",this),o.$setElementDirective(n,"with","$router.model"),t.directives.with.init.call(this,n,"$router.model",this),o.$setElementDirective(n,"template","$parent.template"),location.hash||(location.hash="#/"),this.render(n,o)}bind(t,e,n){window.onhashchange=(()=>{this.model&&Array.from(t.childNodes).forEach(t=>{this.model.$clean(t)}),this.render(t,n)})}}t.$router=new n,t.directive("router",t.$router),t.transform("path",function(e,n){return`#${t.$router.getPath(e,n)}`})});